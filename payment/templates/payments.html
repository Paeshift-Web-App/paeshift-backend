<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Payment Integration Example</title>
  <!-- Include Paystack inline script -->
  <script src="https://js.paystack.co/v1/inline.js"></script>
</head>
<body>
  <h1>Payment Integration</h1>
  <form id="paymentForm">
    <label for="email">Email:</label>
    <input type="email" id="email" required /><br /><br />
    
    <label for="amount">Amount (in Naira):</label>
    <input type="number" id="amount" required /><br /><br />
    
    <button type="button" onclick="payWithPaystack()">Pay with Paystack</button>
    <button type="button" onclick="payWithFlutterwave()">Pay with Flutterwave</button>
  </form>
  
  <script>
    // Function to initialize Paystack payment
    function payWithPaystack() {
      const email = document.getElementById("email").value;
      const amount = document.getElementById("amount").value;
      
      fetch("/api/paystack/initialize", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ email: email, amount: amount })
      })
      .then(response => response.json())
      .then(data => {
        console.log("Paystack response:", data);
        if (data.status) {
          const handler = PaystackPop.setup({
            key: "YOUR_PUBLIC_KEY", // Replace with your actual Paystack public key
            email: email,
            amount: amount * 100, // Convert to kobo
            ref: data.data.reference,
            callback: function(response) {
              alert("Payment successful. Reference: " + response.reference);
            },
            onClose: function() {
              alert("Payment window closed.");
            }
          });
          handler.openIframe();
        } else {
          alert("Error initializing Paystack payment: " + data.message);
        }
      })
      .catch(error => {
        console.error("Error:", error);
        alert("An error occurred while initializing payment.");
      });
    }
    
    // Function to initialize Flutterwave payment
    function payWithFlutterwave() {
      const email = document.getElementById("email").value;
      const amount = document.getElementById("amount").value;
      
      fetch("/api/flutterwave/initialize", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ email: email, amount: amount, currency: "NGN" })
      })
      .then(response => response.json())
      .then(data => {
        console.log("Flutterwave response:", data);
        if (data.status && data.data && data.data.link) {
          window.location.href = data.data.link;
        } else {
          alert("Error initializing Flutterwave payment: " + (data.message || "Unknown error"));
        }
      })
      .catch(error => {
        console.error("Error:", error);
        alert("An error occurred while initializing payment.");
      });
    }
  </script>
</body>
</html>
